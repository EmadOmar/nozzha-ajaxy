/**
 * Nozzha Ajaxy 2.0
 * 
 * @link https://github.com/nozzha/nozzha-ajaxy/
 * @copyright (c) 2014, Nozzha (nozzha.com)
 * @license https://github.com/nozzha/nozzha-ajaxy/blob/master/LICENSE The MIT License (MIT)
 */
!function(o,t){"use strict";o.$ajaxy||(o.$ajaxy=t(jQuery))}(this,function(o){"use strict";function t(o,t){var e=i(t);e._viewDialog=bootbox.dialog({message:o,onEscape:function(){e.onError(3)}}),e.autoFocus&&e._viewDialog.bind("shown.bs.modal",function(){var o=e._viewDialog.find("input:text, textarea").first();o.length&&(o.focus(),o.val(o.val()))})}function e(o){if(3!==o){var t={title:'<span class="text-danger">'+g.errorTitle+"</span>",message:g.errorMessage+" (error-"+o+")",buttons:{close:{label:g.close,className:"btn-warning"}}};return bootbox.dialog(t)}}function n(o){var t=1===o?g.loading:g.submitting,e=1===o?"warning":"info";return bootbox.dialog({title:t,message:'<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar progress-bar-'+e+'" style="width: 100%"></div></div>',closeButton:!1})}function r(o,t){if(!o.status)return i(t).onError(4);var e={title:'<span class="text-success">'+g.successTitle+"</span>",message:g.successMessage,buttons:{ok:{label:g.ok,className:"btn-success"}}};return bootbox.dialog(e)}function a(o,t,e){t?o.onResult(e,o._id):o.onError(2),u(o._id)}function s(o){for(var t="ABCDEFGHIJKLMnopqrstuvwxyz0123456789",e="_",n=3,r=0;n>r;r++){var a=Math.floor(Math.random()*t.length);e+=t.charAt(a)}return e in c?s(o):(c[e]=o,c[e]._id=e,e)}function i(o){if(!(o in c))throw new Error("_boxId("+o+") does not exist");return c[o]}function u(o){for(var t in c)if(t===o){c.splice(t,1);break}}var l={},c=[],d={url:"",data:{},autoFocus:!0,onCreateView:t,onError:e,onProgress:n,onResult:r},g={loading:"Loading...",submitting:"Submitting...",errorTitle:"Something went wrong!",errorMessage:"Please check your internet connection or contact support.",successTitle:"Done!",successMessage:"The form was submitted successfully!",close:"Close",ok:"Ok"};return l.attachTo=function(t,e){t.on("submit",function(n){var r=i(e),s=t.serializeArray();r._viewDialog.modal("hide");var u=r.onProgress(2);return s.push({name:"_nozzhaAjaxySubmit",value:!0}),o.post(t.attr("action"),s).done(function(o){u.modal("hide"),a(r,!0,o)}).fail(function(){u.modal("hide"),a(r,!1,null)}),n.preventDefault(),n.stopImmediatePropagation(),!1})},l.showModalForm=function(t){var e=o.extend({},d);o.extend(e,t);var n=s(e);e.data._nozzhaAjaxy=!0,e.data._nozzhaAjaxyId=n;var r=e.onProgress(1);o.get(e.url,e.data).done(function(o){r.modal("hide"),e.onCreateView(o,n)}).fail(function(){r.modal("hide"),e.onError(1)})},l.translate=function(t){o.extend(g,t)},l});